<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="CryptoPulse.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.Maui;assembly=LiveChartsCore.SkiaSharpView.Maui"
    xmlns:converters="clr-namespace:CryptoPulse.Converters"
    BackgroundColor="#121826">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:DynamicPropertyConverter x:Key="DynamicPropertyConverter" />

            <!-- Default button style so all buttons look consistent -->
            <Style TargetType="Button">
                <Setter Property="CornerRadius" Value="10"/>
                <Setter Property="Padding" Value="12,6"/>
                <Setter Property="BackgroundColor" Value="#1f2a44"/>
                <Setter Property="TextColor" Value="White"/>
                <Setter Property="FontSize" Value="14"/>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="12">

            <!-- Control buttons for live mode, stop, and seeding DB -->
            <HorizontalStackLayout Spacing="8">
                <Button Text="Start Live" Command="{Binding StartLiveCommand}" BackgroundColor="#2e7d32"/>
                <Button Text="Stop Live" Command="{Binding StopLiveCommand}" BackgroundColor="#c62828"/>
                <Button Text="Seed 100k (API)" Command="{Binding SeedCommand}" BackgroundColor="#1565c0"/>
            </HorizontalStackLayout>

            <!-- Status message and seeding progress -->
            <Label Text="{Binding Status}"
                   FontSize="14"
                   TextColor="LightGreen"
                   Margin="0,4"/>

            <ProgressBar Progress="{Binding SeedProgress}"
                         HeightRequest="6"
                         ProgressColor="#00bcd4"/>

            <!-- Chart area (LiveCharts) -->
            <Border Stroke="{x:Null}" StrokeShape="RoundRectangle 12"
                    BackgroundColor="#121826" Padding="8" HeightRequest="300">
                <lvc:CartesianChart
                    Series="{Binding Series}"
                    XAxes="{Binding XAxes}"
                    YAxes="{Binding YAxes}"
                    Tooltip="{x:Null}"
                    ZoomMode="None"
                    AnimationsSpeed="0:0:0"/>
            </Border>

            <!-- Page info and paging controls -->
            <Label Text="{Binding PageInfo}"
                   FontSize="13"
                   TextColor="#FF00AAFF"
                   HorizontalOptions="Center"/>

            <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                <Button Text="◀ Prev"
                        Command="{Binding PrevPageCommand}"
                        IsEnabled="{Binding CurrentPage,
                                            Converter={StaticResource DynamicPropertyConverter},
                                            ConverterParameter=Invert}"/>
                <Label Text="{Binding CurrentPage, StringFormat='Page {0}'}"
                       VerticalOptions="Center"
                       FontSize="14"
                       TextColor="White"/>
                <Button Text="Next ▶"
                        Command="{Binding NextPageCommand}"
                        IsEnabled="{Binding IsLastPage,
                                            Converter={StaticResource DynamicPropertyConverter},
                                            ConverterParameter=Invert}"/>
            </HorizontalStackLayout>

            <!-- SQLite entries list -->
            <Border Stroke="{x:Null}" StrokeShape="RoundRectangle 12"
                    BackgroundColor="#121826" Padding="4" HeightRequest="300">
                <CollectionView ItemsSource="{Binding SQLiteEntries}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="6" ColumnDefinitions="Auto,*,Auto">
                                <!-- Coin symbol -->
                                <Label Text="{Binding CoinId}"
                                       FontSize="13"
                                       TextColor="White"
                                       Grid.Column="0"/>
                                <!-- Timestamp -->
                                <Label Text="{Binding Timestamp}"
                                       FontSize="12"
                                       TextColor="#FF009DFF"
                                       Grid.Column="1"/>
                                <!-- Price -->
                                <Label Text="{Binding Price}"
                                       FontSize="12"
                                       TextColor="LightGreen"
                                       Grid.Column="2"/>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Border>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
